---
title: "RCMIP II Results "
output: html_notebook
---

## Objective 

Visualize the Hector outputs and get an idea of the quality of the IPCC results. 

### Set up the script, load, and format the data. 

```{r, message = FALSE, error = FALSE, warning = FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)

BASE_DIR  <- here::here('output','rcmipII', 'figs')
plot_list <- readRDS(file.path(BASE_DIR,  'plot_list.rds'))
```

Format data into a single data frame to compare with the IPCC results. 

```{r}
data <- dplyr::bind_rows(mutate(plot_list$`rcmipII-ssp119`$ts$data, scn = 'ssp119'),
                         mutate(plot_list$`rcmipII-ssp126`$ts$data, scn = 'ssp126'),
                         mutate(plot_list$`rcmipII-ssp370`$ts$data, scn = 'ssp370'),
                         mutate(plot_list$`rcmipII-ssp585`$ts$data, scn = 'ssp585'))
```


```{r}
data %>%  
  dplyr::filter(year %in% 1995:2014) %>% 
  dplyr::group_by(scn, ensemble) %>% 
  dplyr::summarise(ref_value = mean(value)) %>%  
  dplyr::ungroup(.) -> 
  ref_value_df

data %>%  
  dplyr::filter(year %in% 2041:2060) %>% 
  dplyr::group_by(scn, ensemble) %>% 
  dplyr::summarise(period1 = mean(value)) %>%  
  dplyr::ungroup(.) -> 
  period1_df

data %>%  
  dplyr::filter(year %in% 2081:2100) %>% 
  dplyr::group_by(scn, ensemble) %>% 
  dplyr::summarise(period2 = mean(value)) %>%  
  dplyr::ungroup(.) -> 
  period2_df

df <- dplyr::left_join(ref_value_df, period1_df, by = c("scn", "ensemble")) %>% 
  dplyr::left_join(period2_df, by = c("scn", "ensemble"))

df %>%  
  mutate(period1 = period1 - ref_value, 
         period2 = period2 - ref_value) %>% 
  pivot_longer(names_to = 'period', values_to = 'value', cols = c('period1','period2')) -> 
  df
```


```{r}
plots <- split(df, interaction(df$scn, df$period)) %>% 
  lapply(function(data){
    
    s <- unique(data[['scn']])
    p <- unique(data[['period']])
    
    ggplot(data = data) + 
      geom_density(aes(value)) + 
      theme_bw() + 
      labs(title =  paste0(s, ' ', p))
    
  })
```


### Comparison of Hector output and CMIP6 temp values from the table 

CT was kind enough to share a table of future temp change values. These values are indicated on the density plot with vertical lines, the two black lines indicate the 5 and 95 CI, the red line is the mean value. Looking at the plots Hector is unsurprisingly cool.

```{r,  fig.height=3, fig.width=6}
grid.arrange(plots$ssp119.period1 + 
  geom_vline(xintercept = 0.93, color = 'red') + 
    geom_vline(xintercept = 0.36) + 
     geom_vline(xintercept = 1.5)+ 
  labs(title = '2041 - 2060', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), 
  plots$ssp119.period2 + 
  geom_vline(xintercept = 0.80, color = 'red') + 
    geom_vline(xintercept = 0.10) + 
     geom_vline(xintercept = 1.49) +
  labs(title = '2081 - 2100', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), nrow = 1)
```



```{r,  fig.height=3, fig.width=6}
grid.arrange(plots$ssp126.period1 + 
  geom_vline(xintercept = 1.07, color = 'red') + 
    geom_vline(xintercept = 0.46) + 
     geom_vline(xintercept = 1.67)+ 
  labs(title = '2041 - 2060', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), 
  plots$ssp126.period2 + 
  geom_vline(xintercept = 1.16, color = 'red') + 
    geom_vline(xintercept = 0.41) + 
     geom_vline(xintercept = 1.92) +
  labs(title = '2081 - 2100', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), nrow = 1)
```

```{r,  fig.height=3, fig.width=6}
grid.arrange(plots$ssp370.period1 + 
  geom_vline(xintercept = 1.45, color = 'red') + 
    geom_vline(xintercept = 0.80) + 
     geom_vline(xintercept = 2.1)+ 
  labs(title = '2041 - 2060', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), 
  plots$ssp370.period2 + 
  geom_vline(xintercept = 3.16, color = 'red') + 
    geom_vline(xintercept = 1.84) + 
     geom_vline(xintercept = 4.48) +
  labs(title = '2081 - 2100', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), nrow = 1)
```

```{r,  fig.height=3, fig.width=6}
grid.arrange(plots$ssp585.period1 + 
  geom_vline(xintercept = 1.73, color = 'red') + 
    geom_vline(xintercept = 1.02) + 
     geom_vline(xintercept = 2.45)+ 
  labs(title = '2041 - 2060', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), 
  plots$ssp585.period2 + 
  geom_vline(xintercept = 4.03, color = 'red') + 
    geom_vline(xintercept = 2.42) + 
     geom_vline(xintercept = 5.64) +
  labs(title = '2081 - 2100', 
       subtitle = 'IPCC intervals, mean(red) and 5-95% (black)'), nrow = 1)
```



### Time Series

Idealized Runs
```{r}
plot_list$`rcmipII-1pctCO2`$ts
```


```{r}
plot_list$`rcmipII-abrupt-4xCO2`$ts
```


Future Scenarios

```{r}
plot_list$`rcmipII-ssp119`$ts
```

```{r}
plot_list$`rcmipII-ssp126`$ts
```

```{r}
plot_list$`rcmipII-ssp434`$ts
```

```{r}
plot_list$`rcmipII-ssp460`$ts
```


